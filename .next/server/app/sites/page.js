(()=>{var e={};e.id=669,e.ids=[669],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},56075:()=>{},12768:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),s(59137),s(88571),s(87824);var r=s(93282),a=s(5736),n=s(93906),i=s.n(n),l=s(36880),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["sites",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,59137)),"/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/app/sites/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,88571)),"/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,87824,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/app/sites/page.tsx"],u="/sites/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/sites/page",pathname:"/sites",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},62985:(e,t,s)=>{Promise.resolve().then(s.bind(s,78130)),Promise.resolve().then(s.bind(s,38354))},90473:(e,t,s)=>{Promise.resolve().then(s.bind(s,97419))},96432:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,24424,23)),Promise.resolve().then(s.t.bind(s,37752,23)),Promise.resolve().then(s.t.bind(s,75275,23)),Promise.resolve().then(s.t.bind(s,29842,23)),Promise.resolve().then(s.t.bind(s,1633,23)),Promise.resolve().then(s.t.bind(s,9224,23))},97419:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(73227),a=s(23677),n=s(7392);function i({src:e,token:t,alt:s="",className:n,width:i,height:l}){let[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null);return d?(0,r.jsxs)("div",{className:"text-sm text-red-600",children:["Image: ",d]}):o?r.jsx("img",{src:o,alt:s,className:n,width:i,height:l}):r.jsx("div",{className:"text-gray-500 text-sm",children:"Chargement…"})}!function(){var e=Error("Cannot find module '@/context/AuthProvider'");throw e.code="MODULE_NOT_FOUND",e}();let l="1"===process.env.NEXT_PUBLIC_ENABLE_CREATE_SITES;function o(){let{token:e}=Object(function(){var e=Error("Cannot find module '@/context/AuthProvider'");throw e.code="MODULE_NOT_FOUND",e}())(),[t,s]=(0,a.useState)(""),[o,u]=(0,a.useState)(""),[x,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[g,b]=(0,a.useState)("createdAt"),[j,f]=(0,a.useState)("desc"),[v,y]=(0,a.useState)(10),[N,w]=(0,a.useState)(0),P=function(e,t=300){let[s,r]=(0,a.useState)(e);return s}(t,300),[C,S]=(0,a.useState)([]),[k,_]=(0,a.useState)(0),[q,D]=(0,a.useState)(!1),[A,E]=(0,a.useState)(null),[M,U]=(0,a.useState)(!1),[R,O]=(0,a.useState)(!1),[T,L]=(0,a.useState)(null),[Z,z]=(0,a.useState)({name:"",code:"",location:""}),[B,Q]=(0,a.useState)(null),G=(0,a.useMemo)(()=>Math.floor(N/v)+1,[N,v]),I=(0,a.useMemo)(()=>Math.max(1,Math.ceil(k/Math.max(1,v))),[k,v]);function F(e){g===e?f("asc"===j?"desc":"asc"):(b(e),f("asc")),w(0)}function $(e){w((Math.min(Math.max(1,e),I)-1)*v)}async function J(t){if(t.preventDefault(),e){O(!0),L(null);try{let t={name:Z.name.trim(),code:Z.code.trim()||void 0,location:Z.location.trim()||void 0};if(t.name){await (0,n.createSite)(e,t),U(!1),z({name:"",code:"",location:""}),w(0);let s=await (0,n.listSites)(e,{q:P||void 0,status:o||void 0,from:x||void 0,to:h||void 0,sortBy:g,sortDir:j,limit:v,offset:0});S(s.rows),_(s.count)}else L("Le nom est requis.")}catch(e){L(String(e?.message||"cr\xe9ation impossible"))}finally{O(!1)}}}return e?(0,r.jsxs)("div",{className:"p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[r.jsx("h1",{className:"text-xl font-semibold",children:"Sites"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[l&&r.jsx("button",{onClick:()=>U(!0),className:"rounded-lg bg-black text-white px-3 py-1.5 hover:opacity-95",children:"+ Nouveau"}),r.jsx("div",{className:"text-sm text-gray-500",children:q?"Chargement…":`${k} r\xe9sultat${k>1?"s":""}`})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[r.jsx("input",{value:t,onChange:e=>{s(e.target.value),w(0)},placeholder:"Rechercher (nom ou code)…",className:"rounded-lg border border-gray-300 px-3 py-2 outline-none focus:ring-2 focus:ring-gray-900/10"}),(0,r.jsxs)("select",{value:o,onChange:e=>{u(e.target.value),w(0)},className:"rounded-lg border border-gray-300 px-3 py-2 outline-none focus:ring-2 focus:ring-gray-900/10",children:[r.jsx("option",{value:"",children:"Tous statuts"}),r.jsx("option",{value:"active",children:"Actif"}),r.jsx("option",{value:"archived",children:"Archiv\xe9"})]}),r.jsx("input",{type:"date",value:x,onChange:e=>{m(e.target.value),w(0)},className:"rounded-lg border border-gray-300 px-3 py-2 outline-none focus:ring-2 focus:ring-gray-900/10"}),r.jsx("input",{type:"date",value:h,onChange:e=>{p(e.target.value),w(0)},className:"rounded-lg border border-gray-300 px-3 py-2 outline-none focus:ring-2 focus:ring-gray-900/10"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-sm text-gray-600",children:"Par page"}),r.jsx("select",{value:v,onChange:e=>{y(parseInt(e.target.value,10)||10),w(0)},className:"rounded-lg border border-gray-300 px-2 py-1",children:[5,10,20,50,100].map(e=>r.jsx("option",{value:e,children:e},e))})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:function(){s(""),u(""),m(""),p(""),b("createdAt"),f("desc"),y(10),w(0)},className:"text-sm rounded-lg border px-3 py-2 hover:bg-gray-50",children:"R\xe9initialiser"})})]}),r.jsx("div",{className:"overflow-x-auto border rounded-xl",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx(c,{label:"Code",col:"code",sortBy:g,sortDir:j,onClick:F}),r.jsx(c,{label:"Nom",col:"name",sortBy:g,sortDir:j,onClick:F}),r.jsx(c,{label:"Statut",col:"status",sortBy:g,sortDir:j,onClick:F}),r.jsx(c,{label:"Cr\xe9\xe9 le",col:"createdAt",sortBy:g,sortDir:j,onClick:F}),r.jsx(c,{label:"Maj le",col:"updatedAt",sortBy:g,sortDir:j,onClick:F}),r.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[A&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-4 text-red-600",children:A})}),!A&&0===C.length&&!q&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"p-4 text-gray-500",children:"Aucun r\xe9sultat."})}),C.map(e=>(0,r.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[r.jsx("td",{className:"p-3",children:e.code||"—"}),r.jsx("td",{className:"p-3",children:e.name}),r.jsx("td",{className:"p-3",children:e.status||"—"}),r.jsx("td",{className:"p-3",children:d(e.createdAt)}),r.jsx("td",{className:"p-3",children:d(e.updatedAt)}),r.jsx("td",{className:"p-3",children:r.jsx("div",{className:"flex gap-2",children:r.jsx("button",{onClick:()=>Q(e.id),className:"rounded border px-2 py-1 hover:bg-gray-50",title:"Voir le QR",children:"QR"})})})]},e.id))]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Page ",G,"/",I]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{disabled:G<=1,onClick:()=>$(G-1),className:"rounded-lg border px-3 py-2 disabled:opacity-50",children:"← Pr\xe9c\xe9dent"}),r.jsx("button",{disabled:G>=I,onClick:()=>$(G+1),className:"rounded-lg border px-3 py-2 disabled:opacity-50",children:"Suivant →"})]})]}),l&&M&&r.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Nouveau site"}),r.jsx("button",{onClick:()=>U(!1),className:"text-gray-500 hover:text-black",children:"✕"})]}),T&&r.jsx("div",{className:"mb-3 rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:T}),(0,r.jsxs)("form",{onSubmit:J,className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Nom*"}),r.jsx("input",{value:Z.name,onChange:e=>z({...Z,name:e.target.value}),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-gray-900/10 outline-none",placeholder:"Site D\xe9mo",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Code"}),r.jsx("input",{value:Z.code,onChange:e=>z({...Z,code:e.target.value}),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-gray-900/10 outline-none",placeholder:"DEMO-001"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Localisation"}),r.jsx("input",{value:Z.location,onChange:e=>z({...Z,location:e.target.value}),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-gray-900/10 outline-none",placeholder:"Douala"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[r.jsx("button",{type:"button",onClick:()=>U(!1),className:"rounded-lg border px-3 py-2",children:"Annuler"}),r.jsx("button",{type:"submit",disabled:R,className:"rounded-lg bg-black text-white px-3 py-2 disabled:opacity-50",children:R?"Cr\xe9ation…":"Cr\xe9er"})]})]})]})}),B&&e&&r.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",onClick:()=>Q(null),children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-5",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"QR du site"}),r.jsx("button",{onClick:()=>Q(null),className:"text-gray-500 hover:text-black",children:"✕"})]}),r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(i,{src:(0,n.siteQrPngUrl)(B,512).replace(/^https?:\/\/[^/]+/,""),token:e,alt:"QR code",width:256,height:256})})]})})]}):(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("h1",{className:"text-xl font-semibold mb-2",children:"Sites"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Non authentifi\xe9 – ",r.jsx("a",{className:"underline",href:"/login",children:"connectez-vous"}),"."]})]})}function c({label:e,col:t,sortBy:s,sortDir:a,onClick:n}){let i=s===t;return r.jsx("th",{className:"text-left p-3 font-medium cursor-pointer select-none",onClick:()=>n(t),title:`Trier par ${e}`,children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-1",children:[e,r.jsx("span",{className:"text-gray-400 text-xs",children:i?"asc"===a?"▲":"▼":"△"})]})})}function d(e){if(!e)return"—";try{return new Date(e).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})}catch{return e}}},78130:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(73227),a=s(93984),n=s(6);function i(){return r.jsx("header",{className:"sticky top-0 z-40 backdrop-blur bg-black/20 border-b border-[rgba(255,255,255,0.06)]",children:(0,r.jsxs)("div",{className:"mx-auto max-w-screen-2xl px-4 h-14 flex items-center justify-between",children:[r.jsx("div",{className:"font-medium",children:"Chantiersync — Admin"}),(0,r.jsxs)("button",{className:(0,a.J)("ghost","px-3 py-1"),onClick:function(){},children:[r.jsx(n.Z,{size:16})," Quitter"]})]})})}},38354:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var r=s(73227),a=s(20649),n=s(21205),i=s(32472),l=s(40401),o=s(24751),c=s(32981),d=s(41043);let u=[{href:"/",label:"Dashboard",icon:n.Z},{href:"/partners",label:"Partenaires",icon:i.Z},{href:"/users",label:"Utilisateurs",icon:l.Z},{href:"/tenants",label:"Tenants",icon:o.Z},{href:"/reports",label:"Rapports",icon:c.Z}];function x(){let e=(0,d.usePathname)();return r.jsx("aside",{className:"hidden md:flex md:w-64 md:flex-col gap-2 p-3 border-r border-[rgba(255,255,255,0.08)] bg-black/10",children:u.map(t=>{let s=e===t.href,n=t.icon;return(0,r.jsxs)(a.default,{href:t.href,className:["flex items-center gap-3 rounded-xl px-3 py-2 border",s?"bg-cardbg border-brand":"bg-[#0f172a] border-[rgba(255,255,255,0.08)] hover:border-brand"].join(" "),children:[r.jsx(n,{size:18})," ",r.jsx("span",{children:t.label})]},t.href)})})}},93984:(e,t,s)=>{"use strict";function r(e=""){return["rounded-2xl shadow-soft border border-[rgba(255,255,255,0.08)]","bg-[linear-gradient(180deg,rgba(255,255,255,0.03),transparent),#121a2b]","p-6",e].join(" ")}function a(e="ghost",t=""){return["inline-flex items-center gap-2 rounded-xl px-4 py-2 border transition active:scale-[.98]",{primary:"bg-brand text-white border-[rgba(255,255,255,0.08)] hover:opacity-95",ghost:"bg-[#0f172a] text-text border-[rgba(255,255,255,0.08)] hover:border-brand",subtle:"bg-cardbg text-text border-[rgba(255,255,255,0.08)] hover:border-brand"}[e],t].join(" ")}s.d(t,{J:()=>a,i:()=>r})},7392:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let r=s(85345).Z.create({baseURL:"https://api.chantiersync.com",withCredentials:!0});r.interceptors.request.use(e=>e);let a=r},88571:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(99013);s(20001);var a=s(53189);let n=(0,a.createProxy)(String.raw`/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/components/Header.tsx#default`),i=(0,a.createProxy)(String.raw`/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/components/Sidebar.tsx#default`);function l({children:e}){return r.jsx("html",{lang:"fr",children:(0,r.jsxs)("body",{children:[r.jsx(n,{}),(0,r.jsxs)("div",{className:"mx-auto max-w-screen-2xl px-4 flex gap-4 mt-4",children:[r.jsx(i,{}),r.jsx("main",{className:"flex-1 min-h-[70vh]",children:e})]})]})})}},59137:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(53189).createProxy)(String.raw`/Users/new/Documents/Projets/project-chantiersync/chantiersync/apps/admin/app/sites/page.tsx#default`)},20001:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[847,345],()=>s(12768));module.exports=r})();